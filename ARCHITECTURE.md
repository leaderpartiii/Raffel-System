# ğŸ° ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Raffle Backend (Ğ Ğ¾Ğ»ÑŒ 3)

## ğŸ“Š Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TELEGRAM BOT (Ğ Ğ¾Ğ»ÑŒ 2)                            â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  /start      â”‚  â”‚ ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ    â”‚  â”‚  Ğ£Ñ‡Ğ°ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒâ”‚             â”‚
â”‚  â”‚              â”‚  â”‚  Ğ±Ğ°Ğ»Ğ°Ğ½Ñ      â”‚  â”‚              â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   HTTP API (Flask) - bot_api/api_handlers   â”‚
    â”‚                                             â”‚
    â”‚ POST /wallet/generate                      â”‚
    â”‚ GET  /wallet/balance/<tg_id>              â”‚
    â”‚ POST /raffle/enter                        â”‚
    â”‚ GET  /raffle/status                       â”‚
    â”‚ POST /raffle/draw (ĞĞ”ĞœĞ˜Ğ)                 â”‚
    â”‚ GET  /user/stats/<tg_id>                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         BACKEND LOGIC (Ğ Ğ¾Ğ»ÑŒ 3)             â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚  RaffleProcessor                   â”‚   â”‚
    â”‚  â”‚  - process_user_entry()            â”‚   â”‚
    â”‚  â”‚  - check_user_balance()            â”‚   â”‚
    â”‚  â”‚  - trigger_raffle_draw()           â”‚   â”‚
    â”‚  â”‚  - get_raffle_status()             â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚  WalletManager                     â”‚   â”‚
    â”‚  â”‚  - generate_wallet()               â”‚   â”‚
    â”‚  â”‚  - encrypt_private_key()           â”‚   â”‚
    â”‚  â”‚  - decrypt_private_key()           â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚  UserService / RaffleService       â”‚   â”‚
    â”‚  â”‚  CRUD Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ‘Ğ”                â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Contract Manager (contracts/)              â”‚
    â”‚   - Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Web3                           â”‚
    â”‚   - enterRaffle()                           â”‚
    â”‚   - performUpkeep()                         â”‚
    â”‚   - getPlayers()                            â”‚
    â”‚   - getRecentWinner()                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Database (SQLAlchemy)                    â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚  â”‚ users                            â”‚      â”‚
    â”‚  â”‚ - tg_id (PK)                     â”‚      â”‚
    â”‚  â”‚ - evm_address                    â”‚      â”‚
    â”‚  â”‚ - encrypted_private_key          â”‚      â”‚
    â”‚  â”‚ - total_entries, winnings        â”‚      â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚  â”‚ raffles                          â”‚      â”‚
    â”‚  â”‚ - raffle_id (PK)                 â”‚      â”‚
    â”‚  â”‚ - status, participants, pool     â”‚      â”‚
    â”‚  â”‚ - winner_address, prize_amount   â”‚      â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚  â”‚ transactions                     â”‚      â”‚
    â”‚  â”‚ - tx_hash (PK)                   â”‚      â”‚
    â”‚  â”‚ - tx_type, status, amount        â”‚      â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        BLOCKCHAIN (Web3)                     â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚  â”‚ RPC Endpoint                     â”‚      â”‚
    â”‚  â”‚ (Infura/Alchemy/etc)             â”‚      â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚  â”‚ Raffle Smart Contract            â”‚      â”‚
    â”‚  â”‚ - enterRaffle()                  â”‚      â”‚
    â”‚  â”‚ - performUpkeep() + VRF          â”‚      â”‚
    â”‚  â”‚ - Events: WinnerPicked, etc      â”‚      â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚  â”‚ USDT Token Contract              â”‚      â”‚
    â”‚  â”‚ - transfer(), approve()          â”‚      â”‚
    â”‚  â”‚ - balanceOf()                    â”‚      â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹)

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ğ»Ğ¾Ñ‚ĞµÑ€ĞµÑ

```
1. Ğ‘Ğ¾Ñ‚: POST /api/wallet/generate {"tg_id": "123456789"}
   â†“
2. Backend: WalletManager.generate_wallet()
   â†“
3. Backend: UserService.create_user()
   â†“
4. Ğ‘Ğ”: INSERT INTO users...
   â†“
5. Backend: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ°Ğ´Ñ€ĞµÑ Ğ¸ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
   â†“
6. Ğ‘Ğ¾Ñ‚: ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ°Ğ´Ñ€ĞµÑ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
   â†“
7. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ USDT Ğ²Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
   â†“
8. Ğ‘Ğ¾Ñ‚: POST /api/raffle/enter {"tg_id": "123456789"}
   â†“
9. Backend: RaffleProcessor.process_user_entry()
   â”œâ”€ WalletManager.decrypt_private_key()
   â”œâ”€ ContractManager.check_balance()
   â”œâ”€ ContractManager.enter_raffle()  â† ĞĞ¢ĞŸĞ ĞĞ’Ğ›Ğ¯Ğ•Ğ¢ Ğ¢Ğ ĞĞĞ—ĞĞšĞ¦Ğ˜Ğ®
   â””â”€ TransactionService.create_transaction()
   â†“
10. Ğ‘Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½: Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ enterRaffle() â†’ Ğ­Ğ¼Ğ¸Ñ‚Ğ¸Ñ‚ RaffleEnter
    â†“
11. EventListener: Ğ›Ğ¾Ğ²Ğ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ RaffleEnter
    â†“
12. Backend: ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ ĞºĞ°Ğº CONFIRMED
    â†“
13. Ğ‘Ğ¾Ñ‚: ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ: "âœ… Ğ’Ñ‹ Ğ² Ğ»Ğ¾Ñ‚ĞµÑ€ĞµĞµ!"
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: ĞŸÑ€Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ·Ñ‹Ğ³Ñ€Ñ‹ÑˆĞ°

```
1. ĞĞ´Ğ¼Ğ¸Ğ½: POST /api/raffle/draw (Ñ Authorization)
   â†“
2. Backend: RaffleProcessor.trigger_raffle_draw()
   â”œâ”€ ContractManager.perform_upkeep()
   â””â”€ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ
   â†“
3. Ğ‘Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½: 
   â”œâ”€ performUpkeep() Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ VRF ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ğ¾Ñ€
   â”œâ”€ Chainlink Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾
   â””â”€ Ğ¡Ğ¼Ğ°Ñ€Ñ‚-ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ±ĞµĞ´Ğ¸Ñ‚ĞµĞ»Ñ
   â†“
4. Ğ‘Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½: Ğ­Ğ¼Ğ¸Ñ‚Ğ¸Ñ‚ WinnerPicked(winner, prize)
   â†“
5. EventListener: Ğ›Ğ¾Ğ²Ğ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ WinnerPicked
   â”œâ”€ UserService.get_user_by_address(winner)
   â”œâ”€ RaffleService.finalize_raffle()
   â””â”€ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾Ñ‚Ñƒ
   â†“
6. Ğ‘Ğ¾Ñ‚: 
   â”œâ”€ ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ Ğ°Ğ´Ñ€ĞµÑÑƒ
   â”œâ”€ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ĞµĞ¼Ñƒ: "ğŸ‰ Ğ’Ñ‹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ğ°Ğ»Ğ¸ X USDT!"
   â””â”€ ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑƒĞ¼Ğ¼Ñƒ Ğ¿Ñ€Ğ¸Ğ·Ğ°
   â†“
7. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ· (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸Ğ»Ğ¸ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ)
```

## ğŸ” Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¼Ğ¸ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ğ–Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ°             â”‚
â”‚                                                          â”‚
â”‚  1. Ğ“Ğ•ĞĞ•Ğ ĞĞ¦Ğ˜Ğ¯                                            â”‚
â”‚     â””â”€ WalletManager.generate_wallet()                  â”‚
â”‚        â””â”€ Web3().eth.account.create()                   â”‚
â”‚           â””â”€ private_key = "0x..." (ĞĞ¢ĞšĞ Ğ«Ğ¢Ğ«Ğ™)           â”‚
â”‚                                                          â”‚
â”‚  2. Ğ¨Ğ˜Ğ¤Ğ ĞĞ’ĞĞĞ˜Ğ•                                          â”‚
â”‚     â””â”€ Fernet (AES-256)                                 â”‚
â”‚        â””â”€ encrypted_key = "..." (Ğ—ĞĞ¨Ğ˜Ğ¤Ğ ĞĞ’ĞĞ)            â”‚
â”‚           â””â”€ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² Ğ‘Ğ”                           â”‚
â”‚                                                          â”‚
â”‚  3. Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ•                                       â”‚
â”‚     â””â”€ ĞŸÑ€Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ:         â”‚
â”‚        â”œâ”€ Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ encrypted_key Ğ¸Ğ· Ğ‘Ğ”                    â”‚
â”‚        â”œâ”€ WalletManager.decrypt_private_key()          â”‚
â”‚        â”‚  â””â”€ private_key = "0x..." (Ğ’ ĞŸĞĞœĞ¯Ğ¢Ğ˜)          â”‚
â”‚        â”œâ”€ Web3().eth.account.sign_transaction()       â”‚
â”‚        â””â”€ ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ÑÑ Ğ¸Ğ· Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸           â”‚
â”‚                                                          â”‚
â”‚  4. Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ¬                                        â”‚
â”‚     â”œâ”€ ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ ĞĞ˜ĞšĞĞ“Ğ”Ğ Ğ½Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ² Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ
â”‚     â”œâ”€ Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµÑ‚ÑÑ Ñ ENCRYPTION_KEY Ğ¸Ğ· .env              â”‚
â”‚     â”œâ”€ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ         â”‚
â”‚     â””â”€ ĞĞ• Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ ÑĞµÑ‚Ğ¸ Ğ±ĞµĞ· TLS                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¡ Ğ¡Ğ»ÑƒÑˆĞ°Ñ‚ĞµĞ»Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Event Listener (Ğ‘ĞµÑĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ»)        â”‚
â”‚                                                      â”‚
â”‚  while True:                                        â”‚
â”‚      current_block = w3.eth.block_number            â”‚
â”‚                                                      â”‚
â”‚      # Ğ›Ğ¾Ğ²Ğ¸Ğ¼ WinnerPicked                           â”‚
â”‚      logs = contract.events.WinnerPicked.get_logs()â”‚
â”‚      for log in logs:                               â”‚
â”‚          winner_address = log['args']['winner']    â”‚
â”‚          prize_amount = log['args']['prizeAmount'] â”‚
â”‚                                                      â”‚
â”‚          user = UserService.get_user_by_address()  â”‚
â”‚          if user:                                   â”‚
â”‚              notify_bot(user.tg_id, prize_amount)  â”‚
â”‚              update_database()                      â”‚
â”‚                                                      â”‚
â”‚      sleep(5 ÑĞµĞºÑƒĞ½Ğ´)                               â”‚
â”‚                                                      â”‚
â”‚  # Ğ¢Ğ¾ Ğ¶Ğµ ÑĞ°Ğ¼Ğ¾Ğµ Ğ´Ğ»Ñ RaffleEnter, Ğ´ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ğ² Ğ¸ Ñ‚.Ğ´.  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”Œ Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

### WalletManager â†” Database
- Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾ÑˆĞµĞ»ĞµĞº â†’ ÑˆĞ¸Ñ„Ñ€ÑƒĞµÑ‚ ĞºĞ»ÑÑ‡ â†’ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² Ğ‘Ğ”
- ĞŸÑ€Ğ¸ Ğ²Ñ…Ğ¾Ğ´Ğµ: Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ‘Ğ” â†’ Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚

### ContractManager â†” Database  
- ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ â†’ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ tx_hash Ğ² Ğ‘Ğ”
- Ğ›Ğ¾Ğ²Ğ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ â†’ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑÑ‹ Ğ² Ğ‘Ğ”

### RaffleProcessor â†” ContractManager
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ñ‡ĞµÑ€ĞµĞ· ContractManager
- ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· ContractManager
- ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹

### EventListener â†” Database & Bot API
- Ğ›Ğ¾Ğ²Ğ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¸Ğ· Ğ±Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½Ğ°
- ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ‘Ğ”
- ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ±Ğ¾Ñ‚Ñƒ (Ğ¸Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ webhook)

## ğŸš€ ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ

Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ:
- ~100 Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ (1 ÑĞµÑ€Ğ²ĞµÑ€)
- ~10 Ğ»Ğ¾Ñ‚ĞµÑ€ĞµĞ¹ Ğ² Ğ´ĞµĞ½ÑŒ
- ĞĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½Ğ¾Ğ² Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹ Ğ² Ğ¼ĞµÑÑÑ†

Ğ”Ğ»Ñ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
1. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Redis)
2. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡ (Celery)
3. Ğ Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ ÑĞ»ÑƒÑˆĞ°Ñ‚ĞµĞ»Ğ¸ Ğ½Ğ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ²
4. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ PostgreSQL Ğ²Ğ¼ĞµÑÑ‚Ğ¾ SQLite
5. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ load balancer (nginx)

## ğŸ”— Ğ¡Ğ²ÑĞ·ÑŒ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                          â”‚
â”‚ Ğ Ğ¾Ğ»ÑŒ 1 (Smart Contract Developer)                      â”‚
â”‚ â””â”€ ĞŸÑ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚: ABI, Ğ°Ğ´Ñ€ĞµÑ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ°, Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ   â”‚
â”‚    ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚: feedback Ğ¿Ğ¾ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸                    â”‚
â”‚                                                          â”‚
â”‚ Ğ Ğ¾Ğ»ÑŒ 2 (Bot Developer)                                 â”‚
â”‚ â””â”€ Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚: API endpoints ÑÑ‚Ğ¾Ğ³Ğ¾ Backend               â”‚
â”‚    ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚: Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ          â”‚
â”‚                                                          â”‚
â”‚ Ğ Ğ¾Ğ»ÑŒ 3 (Ğ­Ñ‚Ğ¾Ñ‚ Backend) â† Ğ’Ğ« Ğ—Ğ”Ğ•Ğ¡Ğ¬                      â”‚
â”‚ â””â”€ ĞŸÑ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚: REST API, ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°Ğ¼Ğ¸     â”‚
â”‚    Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚: Smart Contract Ğ¾Ñ‚ Ğ Ğ¾Ğ»Ğ¸ 1                â”‚
â”‚    ĞĞ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚: Ğ‘Ğ¾Ñ‚Ğ° Ğ¾Ñ‚ Ğ Ğ¾Ğ»Ğ¸ 2                         â”‚
â”‚                                                          â”‚
â”‚ Ğ Ğ¾Ğ»ÑŒ 4 (DevOps/Backend Lead)                           â”‚
â”‚ â””â”€ Ğ Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚: ÑÑ‚Ğ¾ Backend Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ               â”‚
â”‚    ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚: Ğ»Ğ¾Ğ³Ğ¸, Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ                â”‚
â”‚    Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµÑ‚: Event Listener Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»                â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸

### Ğ‘Ğ¾Ñ‚ â†’ Backend (HTTP REST)
```
POST /api/raffle/enter
{
  "tg_id": "123456789"
}

Response:
{
  "success": true,
  "tx_hash": "0x...",
  "message": "Entry processed"
}
```

### Backend â†’ Ğ‘Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½ (Web3)
```python
# Python ĞºĞ¾Ğ´ Ğ² ContractManager
tx = contract.functions.enterRaffle().build_transaction({
    'from': user_address,
    'nonce': nonce,
    'gas': 200000,
    'gasPrice': w3.eth.gas_price,
    'chainId': CHAIN_ID
})

signed_tx = w3.eth.account.sign_transaction(tx, private_key)
tx_hash = w3.eth.send_raw_transaction(signed_tx.rawTransaction)
```

### Ğ‘Ğ»Ğ¾ĞºÑ‡ĞµĞ¹Ğ½ â†’ Backend (Event Listener)
```python
# EventListener Ğ»Ğ¾Ğ²Ğ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
logs = contract.events.WinnerPicked.get_logs(
    from_block=last_block,
    to_block=current_block
)

for log in logs:
    winner = log['args']['winner']
    prize = log['args']['prizeAmount']
    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾Ñ‚Ñƒ
```
